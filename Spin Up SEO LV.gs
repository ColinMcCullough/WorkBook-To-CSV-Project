var seoLiquidValueTabHeaders = {
  ssSl: 
  [
    ["name","rec_brand_name", "acc_rej", "usps", "street_address_1", "city", "state","postal_code", "neighborhood", "neighborhood_2",  "landmark_1_name", "custom_slug", "population", "strategy", "gmb", "ga", "redirects", "notes", "pr", "pr_notes", "", "", "", "", "", ""],
    ["V1.0", "SEO Liquid Values", "", "", "", "", "", "","", "", "", "", "", "", "", "", "", "", "Links to Strategies", "", '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit","MF Community A")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1798205500","Townhomes")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1581508741","55+ Apartments")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=320995540","SS Facility A")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=649440825","SL Community A")',""],
    ["Locations", "Recommended Branded Name", "Accepted/Rejected", "USPS Verified", "Address", "City", "State","Zip", "Neighborhood", "Neighborhood_2", "Landmark Required for MF", "Custom Slug (if single domain)", "City Population", "Strategy to Implement", "GMB", "GA", "Redirects", "Notes", "Peer Review Status", "Peer Review Notes", '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=205657231","MF Community B")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=780478088", "Apartments & Townhomes")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=2023923072", "Senior Apartments")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=286369603", "SS Facility A (Landmark Only)")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1742592240", "SL Community B")',""],
    ["", "", "", "", "", "", "","", "comes before City", "comes after City needs near in etc.", "comes after near", "", "", "", "", "", "", "Provide screenshots of search volume and note discrepencies in brand name or address", "", "", '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1615577095", "MF Community C")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1HiTnlOI1LdJbZgMKKUkA16kHfA3IfKZODdGJgitYy84/edit#gid=2128876466", "MF Mobile Homes")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1242508099", "Student Apartments")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1478939980", "SS Facility B")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1248672502", "SL Community C")',""]
  ],
  mf:
  [
    ["name","rec_brand_name", "acc_rej", "usps", "street_address_1", "city", "state","postal_code", "neighborhood", "neighborhood_2", "floor_plans", "landmark_1_name", "property_feature_1", "apartment_amenity_1", "community_amenity_1", "custom_slug", "population", "strategy", "gmb", "ga", "redirects", "notes", "pr", "pr_notes", "", "", "", "", "", ""],
    ["V1.0", "SEO Liquid Values", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "Links to Strategies", "", '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit","MF Community A")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1798205500","Townhomes")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1581508741","55+ Apartments")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=320995540","SS Facility A")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=649440825","SL Community A")', ""],
    ["Locations", "Recommended Branded Name", "Accepted/Rejected", "USPS Verified", "Address", "City", "State","Zip", "Neighborhood", "Neighborhood_2", "Floor Plans", "Landmark Required for MF", "First property feature", "Primary Apartment Amenity", "Primary Community Amenity", "Custom Slug (if single domain)", "City Population", "Strategy to Implement", "GMB", "GA", "Redirects", "Notes", "Peer Review Status", "Peer Review Notes", '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=205657231","MF Community B")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=780478088", "Apartments & Townhomes")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=2023923072", "Senior Apartments")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=286369603", "SS Facility A (Landmark Only)")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1742592240", "SL Community B")', ""],
    ["", "", "", "", "", "", "", "", "comes before City", "comes after City needs near in etc.", "do not include bedrooms use numerical format (ie 1 & 2)", "comes after near", "comes before apartments (ie Luxury Apartments)", "comes after including or with", "", "", "", "", "", "", "", "Provide screenshots of search volume and note discrepencies in brand name or address", "", "", '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1615577095", "MF Community C")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1HiTnlOI1LdJbZgMKKUkA16kHfA3IfKZODdGJgitYy84/edit#gid=2128876466", "MF Mobile Homes")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1242508099", "Student Apartments")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1478939980", "SS Facility B")', '=HYPERLINK("https://docs.google.com/spreadsheets/d/1QR7EH32NxyeGOqARCIt0qYtDX1WpzKMR2BcBqgqz0jY/edit#gid=1248672502", "SL Community C")', ""]
  ] 
};

/*
  @param vertical
  also calls printDefaultNotes which prints notes column in SEO Liquid Values Tab,
  also calls seoLvTabFormatting which bolds notes column, adds data validation, and sets border around range
*/
function setSeoLvTabData(propSheetObj,numLocations,vertical,tabToFormat) { 
  printDefaultNotes(numLocations,propSheetObj,tabToFormat,vertical);
  seoLvTabFormatting(vertical,tabToFormat);
}


/*
  @param vertical
  @param tabToFormat
  This function bolds notes column, adds data validation, and sets border around range
*/
function seoLvTabFormatting(vertical,tabToFormat) {
  var headerRange = tabToFormat.getRange(1,1,1,tabToFormat.getLastColumn()).getValues();
  var notesColumn = tabToFormat.getRange(5,headerRange[0].indexOf("notes") + 1, tabToFormat.getLastRow() -4,1);
  var columnLimit = headerRange[0].indexOf("pr_notes") + 1;
  notesColumn.setFontWeight("bold");
  tabToFormat.getRange(5,1,tabToFormat.getLastRow() -4,columnLimit).setBorder(true, true, true, true, true, true, "black",null)
  seoLvDataValidation(headerRange,tabToFormat);
}

/*
  @param vertical
  This formats rows 2-4. Freezes 1st column, hides 1st row, freezes row 1 - 4, sets color
  and size for first 3 rows, sets appropriates borders
*/
function setLVHeaderFormatting(vertical,domainType,tabToFormat) {
  var domainAndVerticalPrint = [["Vertical:",vertical,"Domain:",domainType]];
  var headerRange = tabToFormat.getRange(1,1,1,tabToFormat.getLastColumn()).getValues(); //header values of liquid values tab 
  var rowTwoRange = tabToFormat.getRange(2,1,1,headerRange[0].indexOf("pr_notes") + 1);
  var rowThreeRange = tabToFormat.getRange(3,1,1,headerRange[0].indexOf("pr_notes") + 1);
  var rowFourRange = tabToFormat.getRange(4,1,1,headerRange[0].indexOf("pr_notes") + 1);
  var strategiesRange = tabToFormat.getRange(2,headerRange[0].indexOf("pr_notes") + 2,3,5);
  
  tabToFormat.setRowHeights(2, 3, 70);   tabToFormat.setColumnWidths(1, 2, 227);   tabToFormat.setColumnWidths(4, 3, 114);
  tabToFormat.hideRows(1);               tabToFormat.setFrozenRows(4);         tabToFormat.setFrozenColumns(1);
  tabToFormat.setColumnWidth(headerRange[0].indexOf("notes") + 1, 262);      // sets column width for notes       
  tabToFormat.setColumnWidth(headerRange[0].indexOf("pr_notes") + 1,262);    // sets column width for pr notes           
  tabToFormat.setColumnWidths(headerRange[0].indexOf("pr_notes") + 2, 5, 150); // sets column widths for strategies
  tabToFormat.setColumnWidths(headerRange[0].indexOf("strategy") + 1, 4, 160); // sets column widths for strategies
  rowTwoRange.setBackgroundRGB(11, 34, 63).setFontColor('white').setFontWeight("bold").setHorizontalAlignment("left").setFontSize(20).setWrapStrategy(SpreadsheetApp.WrapStrategy.OVERFLOW);
  rowThreeRange.setBackgroundRGB(120, 150, 170).setFontColor('white').setHorizontalAlignment("center").setVerticalAlignment("middle").setWrapStrategy(SpreadsheetApp.WrapStrategy.WRAP).setFontSize(12).setBorder(true, true, true, true, true, true, "white",null);
  rowFourRange.setBackgroundColor("light grey 3").setFontColor('black').setFontSize(10).setHorizontalAlignment("left").setVerticalAlignment("middle").setWrapStrategy(SpreadsheetApp.WrapStrategy.WRAP).setBorder(true, true, true, true, true, true, "black",null);
  strategiesRange.setFontSize(11).setHorizontalAlignment("left").setVerticalAlignment("middle").setBorder(true, true, true, true, true, true, "black",null);
  tabToFormat.getRange(2,4,1,4).setValues(domainAndVerticalPrint);
}


/*
  @param val = vertical
  @param val1 = searchString
  @param val3 = result
  This function prints relevant SEO liquid values contstants in SEO Liquid Values
  Tab based on headers in tab.
  MF Prints: Name, address, city, state, zip, floor plans, custom slug, property feature 1
  SS/SL Print: Name, address, city, state, zip,  custom slug
*/
function printSeoLiquidValues(numLocations,searchString, result, vertical) {
  var seoColumnIndex = 0;
  if(vertical == "mf") {
    var seoColumnIndex = seoLiquidValueTabHeaders.mf[0].indexOf(searchString) + 1; //test
  } else {
    var seoColumnIndex = seoLiquidValueTabHeaders.ssSl[0].indexOf(searchString) + 1; //test
  }
  if(seoColumnIndex != 0) {
      var seoValuesRange = seoLvTab.getRange(5, seoColumnIndex, numLocations, 1);
      if(searchString != "postal_code") {
          seoValuesRange.setNumberFormat("@").setWrapStrategy(SpreadsheetApp.WrapStrategy.CLIP);
      }
      //var seoValuesRangeFormatted = seoValuesRange.setNumberFormat("@").setWrapStrategy(SpreadsheetApp.WrapStrategy.CLIP);
      seoValuesRange.setValues(result);
   }
}

/*
  @param val = vertical
  This function prints defines where the data validation should be generated in the SEO Liquid Values tab
  based on vertical. It then calls the defineDataValidation which is responsible for actually building the data validation
*/
function seoLvDataValidation(headerRange, tabToFormat) {
  var gmbColumn = headerRange[0].indexOf("gmb") + 1;
  var gaColumn = headerRange[0].indexOf("ga") + 1;
  var redirectsColumn = headerRange[0].indexOf("redirects") + 1;
  var prColumn = headerRange[0].indexOf("pr") + 1;
  var accOrRejecCol = headerRange[0].indexOf("acc_rej") + 1;
  var uspsCol = headerRange[0].indexOf("usps") + 1;
  var propFeatCol = headerRange[0].indexOf("property_feature_1") + 1;
  defineDataValidation(uspsCol,accOrRejecCol,gmbColumn,gaColumn,redirectsColumn,prColumn,propFeatCol,tabToFormat,headerRange)
}

/*
  @param gmbColumn is the column number where the GMB data Validation will be built
  @param gaColumn is the column number where the GA data Validation will be built
  @param redirectsColumn is the column number where the redirects data Validation will be built
  @param prColumn is the column number where the peer review data Validation will be built
  This function builds and places data validation for the parameters
*/
function defineDataValidation(uspsCol,accOrRejecCol,gmbColumn,gaColumn,redirectsColumn,prColumn,propFeatCol,tabToFormat,headerRange) {
  var acceptedRejectValRange = tabToFormat.getRange(5,accOrRejecCol,tabToFormat.getLastRow() -4,1); //Accepted/Rejected range
  var acceptedRejectVal = SpreadsheetApp.newDataValidation().requireValueInList(["Accepted", "Rejected"], true).build(); //Accepted/Rejected validation builder
  var uspsValRange = tabToFormat.getRange(5,uspsCol,tabToFormat.getLastRow() -4,1); //usps range
  var uspsVal = SpreadsheetApp.newDataValidation().requireValueInList(["Yes", "No"], true).build(); //usps validation builder
  var gmbValRange = tabToFormat.getRange(5,gmbColumn,tabToFormat.getLastRow() -4,1); //gmb range
  var gmbVal = SpreadsheetApp.newDataValidation().requireValueInList(["Requested","Accessed","Create New","Unverified","N/A LP"], true).build(); //gmb validation builder
  var gaValRange = tabToFormat.getRange(5,gaColumn,tabToFormat.getLastRow() -4,1); //ga range
  var gaVal = SpreadsheetApp.newDataValidation().requireValueInList(["Requested","Accessed","Create New","Use Current Domain"], true).build(); //ga validation builder
  var redirectsValRange = tabToFormat.getRange(5,redirectsColumn,tabToFormat.getLastRow() -4,1); //redirects range
  var redirectsVal = SpreadsheetApp.newDataValidation().requireValueInList(["Same Domain","Cross Domain","Secure Naked - Same Domain","Secure - Cross Domain","No Redirects"], true).build(); //redirects validation builder
  var prValRange = tabToFormat.getRange(5,prColumn,tabToFormat.getLastRow() -4,1); //peer review range
  var prVal = SpreadsheetApp.newDataValidation().requireValueInList(["Incomplete","Complete"], true).build(); //peer review validation builder
  if(propFeatCol != 0) {
    var propFeatureRange = tabToFormat.getRange(5,propFeatCol,tabToFormat.getLastRow() -4,1); //peer review range
    var propFeatureVal = SpreadsheetApp.newDataValidation().requireValueInList(["Luxury","Affordable","Modern","Gated","Furnished","Garden Style","High Rise","New","Upgraded"], true).build(); //first prop feature builder
    propFeatureRange.setDataValidation(propFeatureVal);
  }
  //sets Data validation that was built above
  acceptedRejectValRange.setDataValidation(acceptedRejectVal); // sets accepted rejected validation
  uspsValRange.setDataValidation(uspsVal); // sets usps column validation
  gmbValRange.setDataValidation(gmbVal); // sets gmb column validation
  gaValRange.setDataValidation(gaVal); // sets ga column validation
  redirectsValRange.setDataValidation(redirectsVal); // sets redirects column validation
  prValRange.setDataValidation(prVal); // sets redirects column validation
  defineConditionalFormatting(acceptedRejectValRange,uspsValRange,gmbValRange,gaValRange,redirectsValRange,prValRange,tabToFormat); //created conditional formatting
}

function defineConditionalFormatting(acceptedRejectValRange,uspsValRange,gmbValRange,gaValRange,redirectsValRange,prValRange,tabToFormat) {
  var brandNameRuleAccepted = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Accepted").setBackground("#b7e1cd").setRanges([acceptedRejectValRange]).build();
  var brandNameRuleAcceptedRejected = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Rejected").setBackground("#f4c7c3").setRanges([acceptedRejectValRange]).build();
  var uspsVerified = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Yes").setBackground("#b7e1cd").setRanges([uspsValRange]).build();
  var uspsNotVerified = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("No").setBackground("#f4c7c3").setRanges([uspsValRange]).build();
  var gmbAccessed = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Accessed").setBackground("#b7e1cd").setRanges([gmbValRange]).build();
  var gmbRequested = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Requested").setBackground("#fce8b2").setRanges([gmbValRange]).build();
  var gmbCreateNew = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Create New").setBackground("#d9d9d9").setRanges([gmbValRange]).build();
  var gaAccessed = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Accessed").setBackground("#b7e1cd").setRanges([gaValRange]).build();
  var gaRequested = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Requested").setBackground("#fce8b2").setRanges([gaValRange]).build();
  var gaCreateNew = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Create New").setBackground("#d9d9d9").setRanges([gaValRange]).build();
  var prComplete = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Complete").setBackground("#b7e1cd").setRanges([prValRange]).build();
  var prIncomplete = SpreadsheetApp.newConditionalFormatRule().whenTextEqualTo("Incomplete").setBackground("#f4c7c3").setRanges([prValRange]).build();
  var rules = tabToFormat.getConditionalFormatRules();
  rules.push(brandNameRuleAccepted,brandNameRuleAcceptedRejected,uspsVerified,uspsNotVerified,gmbAccessed,gmbRequested,gmbCreateNew,gaAccessed,gaRequested,gaCreateNew,prComplete,prIncomplete);
  tabToFormat.setConditionalFormatRules(rules);
}

/*
  @param val = vertical
  sets notes column in seo liquid values tab
  This function is used in the initial set header function called in main()
*/
function printDefaultNotes(numLocations,propSheetObj,tabToFormat,vertical) {
  var notesColumn;
  var prColumn;
  if(vertical == "mf") {
    notesColumn = seoLiquidValueTabHeaders.mf[0].indexOf("notes") + 1; //test
    prColumn = seoLiquidValueTabHeaders.mf[0].indexOf("pr") + 1; //test
  } else {
    notesColumn = seoLiquidValueTabHeaders.ssSl[0].indexOf("notes") + 1; //test
    prColumn = seoLiquidValueTabHeaders.ssSl[0].indexOf("pr") + 1; //test
  }
  var notesArry = [];
  var prArry = [];
  var currentWebsites = []; 
  currentWebsites.push(propSheetObj.getRowValByTag("current_website"));
  var negativeKeywords = []; 
  negativeKeywords.push(propSheetObj.getRowValByTag("negative_keywords")); 
  var primaryType = []; 
  primaryType.push(propSheetObj.getRowValByTag("primary_type")); 
  fillNotesCol(currentWebsites,notesArry,prArry,vertical,negativeKeywords,primaryType);
  seoLvTab.getRange(5,notesColumn,numLocations,1).setValues(notesArry);
  seoLvTab.getRange(5,prColumn,numLocations,1).setValues(prArry);
}

//helper function to full notes column called from printDefaultNotes function
function fillNotesCol(currentWebsites,notesArry,prArry,vertical,negativeKeywords,primaryType) {
  for(i = 0; i < currentWebsites[0].length;i++) {
    var existSite = function(x) {if(x != "") return x; if(x == "") return "None in workbook"};
    var negKey = function(x) {if(x != "") return "\nNegative Keywords: " + x; else return ""}; //gets negative keywords if available, otherwise leaves empty   
    if(vertical == "mf") {
      var vertVal = function(v,y) {if(v == "mf") return "\nLandmark: \nAmenity: \nPrimaryType: " + y ; else return ""};  //fills var with multi family keyword research headers if vertical == mf
      notesArry.push(["Existing Site: " + existSite(currentWebsites[0][i]) + negKey(negativeKeywords[0][i]) + "\nNeighborhood: " + vertVal(vertical,primaryType[0][i])]);
    } else {
      notesArry.push(["Existing Site: " + existSite(currentWebsites[0][i]) + negKey(negativeKeywords[0][i]) + "\nNeighborhood: "]);
    }
    prArry.push(["Incomplete"]);
  } 
}
/*
//helper function to get values from workbook used in notes column
function getNotesDataArray(val) {
  var columnValues = propertySheet.getRange(2, 1, propertySheet.getLastRow()).getValues();
  var flatColVal = [].concat.apply([], columnValues);
  var searchResult = flatColVal.indexOf(val);
  if(searchResult != -1) {
    searchResult += 2;
    var numofItems = seoLvTab.getLastRow() - 4;
    var currentWebsiteArray = propertySheet.getRange(searchResult, 4, 1, numofItems).getValues();

    return currentWebsiteArray;
  }
}
*/

